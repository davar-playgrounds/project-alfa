pipeline {
  agent any
  environment {
    DOCKER_HUB_USER = "kbulix" // This is Docker Hub user
    PROJECT = "web-express"

  }
  stages {
    stage('Build') {
      steps {

      def dockerCloudParameters = [
        connectTimeout:   3,
        containerCapStr:  '4',
        credentialsId:    '',
        dockerHostname:   '',
        name:             'docker.local',
        readTimeout:      60,
        serverUrl:        'unix:///var/run/docker.sock',
        version:          ''
      ]


        sh "docker image build -t ${DOCKER_HUB_USER}/${PROJECT}:beta-${env.BRANCH_NAME}-${env.BUILD_NUMBER} ."

        withCredentials([usernamePassword(
                credentialsId: "docker",
                usernameVariable: "USER",
                passwordVariable: "PASS"
        )]) {
        sh "docker login -u '$USER' -p '$PASS'"
        }
        sh "docker image push ${DOCKER_HUB_USER}/${PROJECT}:beta-${env.BRANCH_NAME}-${env.BUILD_NUMBER}"
      }
    }
  }
}
